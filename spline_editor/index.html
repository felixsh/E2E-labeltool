<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>D3 Spline Editor – Velocity & Acceleration</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <!-- Removed: Add button -->
      <button id="delBtn" title="Delete selected (D or Delete)">Delete</button>

      <span class="sep"></span>

      <label class="alpha">
        α <input id="alpha" type="range" min="0" max="1" step="0.01" value="0.5" />
        <span id="alphaVal" class="badge">0.50</span>
      </label>

      <label>
        Curve
        <select id="curveType">
          <option value="catmullrom">Catmull–Rom</option>
          <option value="basis" selected>Basis</option>
          <option value="natural">Natural</option>
        </select>
      </label>

      <label>
        <input type="checkbox" id="showSamplesChk" checked />
        Samples
      </label>

      <label>
        <input type="checkbox" id="showWeightsChk" />
        Weights
      </label>

      <span class="sep"></span>

      <button id="optimizeBtn" title="Re-space intermediate points to minimize jerk">Optimize</button>
      <button id="exportSamplesBtn" title="Export samples in meters (E)">Export samples</button>

      <span class="sep"></span>

      <!-- New: proper shortcut sheet -->
      <button id="shortcutsBtn" title="Show help (? key)">Help</button>

      <!-- Removed: inline “keys” description/hint -->
    </div>

    <div class="main">
      <svg id="svg"></svg>

      <!-- Optimization weights panel (only shown when samples are on) -->
      <div id="weights" class="panel" aria-label="Optimization weights" title="Optimization weights used by the Optimize action">
        <div class="panel-header">Optimization weights</div>
        <div class="row">
          <label>Jerk
            <input id="wJerk" type="range" min="0" max="3" step="0.01" value="1.00" />
            <span id="wJerkVal" class="badge">1.00</span>
          </label>
        </div>
        <div class="row">
          <label>Speed penalty
            <input id="wVel" type="range" min="0" max="1" step="0.01" value="0.10" />
            <span id="wVelVal" class="badge">0.10</span>
          </label>
        </div>
        <div class="row">
          <label>Accel penalty
            <input id="wAcc" type="range" min="0" max="1" step="0.01" value="0.10" />
            <span id="wAccVal" class="badge">0.10</span>
          </label>
        </div>
      </div>

      <div id="charts">
        <svg id="velChart"></svg>
        <svg id="accLongChart"></svg>
        <svg id="accLatChart"></svg>
      </div>
    </div>
  </div>

  <!-- Shortcuts modal -->
  <div id="shortcutsModal" class="modal hidden" aria-modal="true" role="dialog">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Help</h3>
        <button id="shortcutsClose" class="icon-btn" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <ul class="klist">
          <li><b>Click empty canvas</b> — insert control point <i>after selected</i></li>
          <li><b>Click control / sample</b> — select / deselect</li>
          <li><b>Drag control</b> — move control point</li>
          <li><b>Drag sample</b> — slide along spline</li>
          <li><b>Delete / Backspace</b> — delete selected control point</li>
          <li><b>Arrow keys</b> — nudge selected control (hold <b>Shift</b> for bigger step)</li>
          <li><b>↑ / ↓</b> on sample — move selected sample along spline (hold <b>Shift</b> for bigger step)</li>
          <li><b>S</b> — toggle samples & charts</li>
          <li><b>E</b> — export samples <i>(in meters)</i></li>
          <li><b>?</b> — open/close this sheet</li>
          <li><b>O</b> — optimize intermediate points</li>
          <li><b>W</b> — toggle Weights panel</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- D3 v7 + Config + App -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="config.js"></script>
  <script src="app.js" defer></script>
</body>
</html>
